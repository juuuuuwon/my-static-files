<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Markdown Viewer - Precise Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
        background: #1e1e1e;
        color: #d4d4d4;
      }

      /* í—¤ë” ìŠ¤íƒ€ì¼ */
      .header {
        background: #2d2d30;
        padding: 1rem;
        border-bottom: 1px solid #3e3e42;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .header h1 {
        font-size: 1.2rem;
        color: #ffffff;
      }

      /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
      .container {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      .editor-pane,
      .preview-pane {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
      }

      .pane-header {
        background: #2d2d30;
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #3e3e42;
        font-weight: 600;
        color: #cccccc;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      /* ì—ë””í„° ìŠ¤íƒ€ì¼ */
      #editor {
        flex: 1;
        padding: 1rem;
        border: none;
        outline: none;
        font-family: "Consolas", "Monaco", monospace;
        font-size: 14px;
        line-height: 1.6;
        resize: none;
        background: #1e1e1e;
        color: #d4d4d4;
      }

      /* ë¯¸ë¦¬ë³´ê¸° ìŠ¤íƒ€ì¼ */
      #preview {
        flex: 1;
        padding: 4rem;
        overflow-y: auto;
        background: #ffffff;
        color: #1a1a1a;
        position: relative;
      }

      /* ì»¤ì„œ ì (Indicator) ë””ìì¸ */
      #cursor-indicator {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: #3b82f6;
        border-radius: 50%;
        opacity: 0.7;
        pointer-events: none;
        transition: all 0.1s ease-out; /* ë¶€ë“œëŸ¬ìš´ ì¶”ì  */
        z-index: 100;
        box-shadow: 0 0 6px rgba(59, 130, 246, 0.4);
        display: none;
      }

      /* ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ ìŠ¤íƒ€ì¼ */
      #preview-content {
        line-height: 1.75;
      }
      #preview-content h1 {
        font-size: 2.25em;
        margin-bottom: 0.5em;
        border-bottom: 1px solid #eee;
        font-weight: 700;
      }
      #preview-content h2 {
        font-size: 1.75em;
        margin-top: 1.5em;
        border-bottom: 1px solid #f0f0f0;
      }
      #preview-content p {
        margin-bottom: 1.2em;
      }
      #preview-content code {
        background: #f3f4f6;
        padding: 0.2em 0.4em;
        border-radius: 4px;
        color: #dc2626;
        font-size: 0.9em;
        font-family: monospace;
      }
      #preview-content pre {
        background: #1f2937;
        padding: 1.2em;
        border-radius: 8px;
        color: #fff;
        overflow-x: auto;
        margin: 1.5em 0;
      }
      #preview-content blockquote {
        border-left: 4px solid #3b82f6;
        padding: 0.5em 1.2em;
        background: #f0f7ff;
        color: #1e40af;
        margin: 1.5em 0;
      }
      #preview-content ul,
      #preview-content ol {
        margin-bottom: 1.2em;
        padding-left: 1.5em;
      }

      /* ì „ì²´í™”ë©´ ë²„íŠ¼ */
      .fullscreen-btn {
        background: #007acc;
        color: white;
        border: none;
        padding: 0.4rem 0.8rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8rem;
      }

      .preview-pane.fullscreen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1000;
      }

      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>ğŸ“ ë§ˆí¬ë‹¤ìš´ ë·°ì–´</h1>
    </div>

    <div class="container">
      <div class="editor-pane">
        <div class="pane-header">ë§ˆí¬ë‹¤ìš´ ì…ë ¥</div>
        <textarea
          id="editor"
          placeholder="ì—¬ê¸°ì— ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."
        ></textarea>
      </div>

      <div class="preview-pane">
        <div class="pane-header">
          <span>ë¯¸ë¦¬ë³´ê¸°</span>
          <button class="fullscreen-btn" id="fullscreenBtn">ğŸ” ì „ì²´í™”ë©´</button>
        </div>
        <div id="preview">
          <div id="preview-content"></div>
          <div id="cursor-indicator"></div>
        </div>
      </div>
    </div>

    <script>
      const editor = document.getElementById("editor");
      const preview = document.getElementById("preview");
      const previewContent = document.getElementById("preview-content");
      const indicator = document.getElementById("cursor-indicator");
      const fullscreenBtn = document.getElementById("fullscreenBtn");
      const previewPane = document.querySelector(".preview-pane");
      const editorPane = document.querySelector(".editor-pane");

      marked.setOptions({ breaks: true, gfm: true });

      function updatePreview() {
        const text = editor.value;
        const cursorPos = editor.selectionStart;

        // 1. í˜„ì¬ ì»¤ì„œ ìœ„ì¹˜ì— ë³´ì´ì§€ ì•ŠëŠ” ë§ˆì»¤ ì‚½ì…
        const textWithMarker =
          text.substring(0, cursorPos) +
          '<span id="sync-marker"></span>' +
          text.substring(cursorPos);

        // 2. ë§ˆí¬ë‹¤ìš´ ë³€í™˜
        previewContent.innerHTML = marked.parse(textWithMarker);

        // 3. ë§ˆì»¤ ìœ„ì¹˜ë¥¼ ì°¾ì•„ì„œ ì (Indicator) ë°°ì¹˜
        const marker = document.getElementById("sync-marker");
        if (marker) {
          const markerTop = marker.offsetTop;
          const markerLeft = marker.offsetLeft;

          // ì˜¤í”„ì…‹ ì œê±°: í˜„ì¬ ì»¤ì„œ ì¤„ì— ë°”ë¡œ í‘œì‹œ (ì •ë ¬ì„ ìœ„í•´ ì•½ê°„ì˜ ë³´ì •ê°’ 2pxë§Œ ì¶”ê°€)
          const verticalCorrection = 7;

          indicator.style.display = "block";
          indicator.style.top = markerTop + verticalCorrection + "px";
          indicator.style.left = markerLeft + "px";

          // ì»¤ì„œê°€ ë³´ì´ì§€ ì•ŠëŠ” ì˜ì—­ìœ¼ë¡œ ê°€ë©´ ìë™ ìŠ¤í¬ë¡¤
          const previewHeight = preview.clientHeight;
          const currentScroll = preview.scrollTop;

          if (
            markerTop < currentScroll ||
            markerTop > currentScroll + previewHeight - 100
          ) {
            preview.scrollTo({
              top: markerTop - previewHeight / 2,
              behavior: "smooth",
            });
          }
        }
      }

      // ì „ì²´í™”ë©´ í† ê¸€
      fullscreenBtn.addEventListener("click", () => {
        previewPane.classList.toggle("fullscreen");
        editorPane.classList.toggle("hidden");
        fullscreenBtn.textContent = previewPane.classList.contains("fullscreen")
          ? "â†©ï¸ ë‚˜ê°€ê¸°"
          : "ğŸ” ì „ì²´í™”ë©´";
      });

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ: ì…ë ¥, í´ë¦­, ë°©í–¥í‚¤ ì´ë™ ì‹œ ì—…ë°ì´íŠ¸
      editor.addEventListener("input", updatePreview);
      editor.addEventListener("click", updatePreview);
      editor.addEventListener("keyup", (e) => {
        if (
          [
            "ArrowUp",
            "ArrowDown",
            "ArrowLeft",
            "ArrowRight",
            "PageUp",
            "PageDown",
          ].includes(e.key)
        ) {
          updatePreview();
        }
      });

      // ì´ˆê¸° ì‹¤í–‰
      updatePreview();
    </script>
  </body>
</html>
